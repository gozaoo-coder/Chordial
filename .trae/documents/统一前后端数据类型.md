## 目标

统一 Chordial 项目前后端数据类型，创建 Artist、ArtistSummary、Album、AlbumSummary、Track 类型系统，并实现前端类包装。

## 实施步骤

### 第一阶段：后端 Rust 类型定义

1. 创建 `src-tauri/src/music_source/artist.rs`:

   * `Artist` 完整类型

   * `ArtistSummary` 摘要类型（含 `get_full_info()` 方法）

2. 创建 `src-tauri/src/music_source/album.rs`:

   * `Album` 完整类型

   * `AlbumSummary` 摘要类型（含 `get_full_info()` 方法）

3. 更新 `src-tauri/src/music_source/source_manager.rs`:

   * `TrackMetadata` 添加 `artist_summary: Option<ArtistSummary>` 和 `album_summary: Option<AlbumSummary>`

   * 支持多歌手解析（`/` 和 `&` 分隔符）

4. 更新 `MusicLibrary` 添加 `artists` 和 `albums` 字段

### 第二阶段：多歌手解析功能

1. 创建 `src-tauri/src/music_source/artist_parser.rs`:

   * `parse_artists(name: &str) -> Vec<String>` - 解析 `/` 和 `&` 分隔的歌手名

   * `normalize_artist_name(name: &str) -> String` - 规范化歌手名

### 第三阶段：后端命令接口

1. 在 `src-tauri/src/lib.rs` 添加命令:

   * `get_artist_info(id: String) -> Result<Artist, String>`

   * `get_artist_summary(id: String) -> Result<ArtistSummary, String>`

   * `get_album_info(id: String) -> Result<Album, String>`

   * `get_album_summary(id: String) -> Result<AlbumSummary, String>`

   * `get_artists_by_ids(ids: Vec<String>) -> Result<Vec<Artist>, String>`

   * `get_albums_by_ids(ids: Vec<String>) -> Result<Vec<Album>, String>`

### 第四阶段：扫描器更新

1. 更新 `src-tauri/src/scanner/music_scanner.rs`:

   * 扫描时解析多歌手信息

   * 构建 Artist 和 Album 数据

   * 生成摘要信息嵌入 Track

### 第五阶段：前端类型定义

1. 创建 `src/types/` 目录和类型定义文件

### 第六阶段：前端 Class 实现（重点）

1. 创建 `src/class/Artist.js`:

   ```javascript
   class Artist {
     constructor(data) { /* 包装数据 */ }
     static async fromSummary(summary) { /* 从摘要获取完整信息 */ }
     async getFullInfo() { /* 获取完整信息 */ }
   }
   ```

2. 创建 `src/class/ArtistSummary.js`:

   ```javascript
   class ArtistSummary {
     constructor(data) { /* 包装数据 */ }
     async getFullInfo() { /* 调用 API 获取完整 Artist */ }
   }
   ```

3. 创建 `src/class/Album.js` 和 `src/class/AlbumSummary.js`（类似结构）

4. 创建 `src/class/Track.js`:

   ```javascript
   class Track {
     constructor(data) {
       this.artistSummary = new ArtistSummary(data.artist_summary);
       this.albumSummary = new AlbumSummary(data.album_summary);
     }
   }
   ```

### 第七阶段：前端 API 层（数据包装）

1. 创建 `src/api/artist.js`:

   * API 返回的数据必须经过 `Artist` 或 `ArtistSummary` 类包装

   * `getArtist(id) -> Promise<Artist>`

   * `getArtistSummary(id) -> Promise<ArtistSummary>`

2. 创建 `src/api/album.js`（类似结构）

3. 更新 `src/api/musicSource/` 中的 API，返回的 Track 数据用 `Track` 类包装

## 关键设计

### 多歌手解析示例

```rust
// "周杰伦/费玉清" -> ["周杰伦", "费玉清"]
// "Taylor Swift & Ed Sheeran" -> ["Taylor Swift", "Ed Sheeran"]
```

### 前端类方法设计

```javascript
// ArtistSummary 类
class ArtistSummary {
  async getFullInfo() {
    return await getArtist(this.id); // 返回 Artist 实例
  }
}

// Track 类
class Track {
  get artist() { return this.artistSummary; }
  get album() { return this.albumSummary; }
}
```

### 数据流向

```
后端 API -> 原始数据 -> Class 构造函数 -> 包装后的实例 -> 前端使用
```

