## 修复音乐播放问题

### 问题分析

根据代码审查，发现以下可能导致播放失败的问题：

1. **音频设备初始化失败** - 没有默认音频设备时会直接报错
2. **时间拉伸器创建失败** - rubato 库的资源要求较高，可能初始化失败
3. **错误信息无法传递到前端** - Rust 端的错误只打印到 stderr
4. **音频线程启动失败处理不完善**

### 修复步骤

#### 1. 改进音频输出设备错误处理

* 文件：`src-tauri/src/audio_engine/output/cpal_output.rs`

* 添加更详细的错误信息和备用方案

* 添加音频设备状态检查

#### 2. 修复时间拉伸器初始化

* 文件：`src-tauri/src/audio_engine/time_stretch.rs`

* 添加初始化失败时的降级处理

* 使用更轻量的重采样配置作为备选

#### 3. 增强音频播放器错误处理

* 文件：`src-tauri/src/audio_engine/player.rs`

* 添加音频线程启动失败的详细错误返回

* 添加状态检查方法

#### 4. 改进前端错误处理和日志

* 文件：`src/stores/player.js`

* 添加更详细的错误日志

* 改进音频 URL 获取的错误处理

#### 5. 添加音频系统健康检查

* 创建音频系统诊断功能

* 在应用启动时检查音频设备可用性

### 验证步骤

1. 运行 `cargo check` 确保 Rust 代码无错误
2. 运行 `pnpm vue-tsc --noEmit` 确保 TypeScript 类型正确
3. 测试播放功能
4. 检查控制台错误日志

