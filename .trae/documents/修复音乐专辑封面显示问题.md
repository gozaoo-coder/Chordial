## 问题总结

音乐专辑图片在以下场景无法正常显示：
1. 首页"最近添加"列表中的歌曲封面
2. 底部播放栏的当前歌曲封面
3. 专辑详情页封面（用户补充）

而专辑列表页能正常显示封面。

## 根本原因

1. **Track 类问题**：`Track.getCoverUrl()` 只返回 `albumCoverData` 或 `album.getCoverUrl()`，但 `AlbumSummary.coverData` 始终为 `null`
2. **Track 类问题**：`Track.getCoverResource()` 只在 `albumCoverData` 存在时才返回资源，没有通过 `album.getCoverResource()` 从专辑获取封面
3. **useCoverImages composable 问题**：它期望对象有 `getCoverResource` 方法，但 `Track` 对象的该方法实现不完整

## 修复步骤

### 1. 修复 Track 类的 getCoverResource 方法
文件：`src/class/Track.js`
- 修改 `getCoverResource()` 方法，当 `albumCoverData` 不存在时，尝试通过 `this._albumSummary.getCoverResource()` 获取封面

### 2. 修复 PlayerControlBar.vue 的封面获取逻辑
文件：`src/components/player/PlayerControlBar.vue`
- 需要异步加载封面，可以使用 `useCoverImage` composable 或监听当前歌曲变化并加载封面

### 3. 修复 AlbumDetail.vue 的封面获取逻辑（如果需要）
文件：`src/views/AlbumDetail.vue`
- 确保 `useCoverImage` 能正确加载封面

## 具体修改

### 修改 1: src/class/Track.js
```javascript
/**
 * 获取封面 BlobResource（用于资源管理）
 * @param {string} size - 图片尺寸 ('small', 'medium', 'large')
 * @returns {Promise<BlobResource|null>}
 */
async getCoverResource(size = 'medium') {
  // 如果已有 coverResource，直接返回
  if (this._coverResource) {
    return this._coverResource;
  }
  
  // 如果有 albumCoverData，创建 BlobResource
  if (this.albumCoverData && this.albumCoverData.startsWith('data:image/')) {
    // ... 现有代码 ...
    return this._coverResource;
  }
  
  // 如果没有 albumCoverData，尝试从 album 获取
  if (this._albumSummary) {
    try {
      const albumResource = await this._albumSummary.getCoverResource(size);
      if (albumResource) {
        return albumResource;
      }
    } catch (err) {
      console.warn('Failed to get cover from album:', err);
    }
  }
  
  return null;
}
```

### 修改 2: src/components/player/PlayerControlBar.vue
使用 `useCoverImage` composable 来加载当前歌曲的封面：
```javascript
import { useCoverImage } from '@/composables/useCoverImage';

// 在 setup 中
const { coverUrl: currentCoverUrl } = useCoverImage(
  computed(() => currentTrack.value), 
  'small'
);
```

### 修改 3: 验证 TrackList.vue
确保 `useCoverImages` 能正确处理 `Track` 对象，可能需要修改 `useCoverImages` 以支持异步获取 `getCoverResource` 方法。